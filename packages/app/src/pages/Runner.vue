<template>
  <Runner
    v-if="query.data.value?.app && initialized"
    :gql="query.data.value.app"
  />
</template>

<script lang="ts">
export default defineComponent({
  name: 'Runner',
})
</script>

<script lang="ts" setup>
import { gql } from '@urql/core'
import { useQuery } from '@urql/vue'
import { defineComponent, onMounted, ref } from 'vue'
import { Runner_AllDocument } from '../generated/graphql'
import { UnifiedRunnerAPI } from '../runner'
import Runner from '../runs/SpecRunner.vue'

gql`
query Runner_All {
  app {
    ...Specs_SpecsList
  }
}
`

const initialized = ref(false)

onMounted(async () => {
  await UnifiedRunnerAPI.initialize()
  initialized.value = true
})

// network-only - we do not want to execute a stale spec
const query = useQuery({
  query: Runner_AllDocument,
  requestPolicy: 'network-only',
})
</script>

<route>
{
  name: "Runner"
}
</route>
