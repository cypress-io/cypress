<template>
  <div
    tabindex="0"
    data-cy="collapsible"
    @keypress.space.enter.self="toggle"
  >
    <div
      data-cy="collapsible-header"
      :aria-expanded="isOpen"
      class="rounded-t focus:outline-indigo-500"
      :class="{'rounded-b': !isOpen}"
      @click="toggle"
      @keypress.space.enter.self="toggle"
    >
      <slot
        name="target"
        :open="isOpen"
      />
    </div>
    <div
      :style="{
        maxHeight: isOpen ? maxHeight : '0px',
      }"
      :aria-hidden="!isOpen"
      :class="{
        'overflow-auto transition transition-all duration-500 animate-ease-[cubic-bezier(0.25,0.1,0.25,1)]': isOpen,
      }"
    >
      <slot
        v-if="!lazy || lazy && isOpen"
        :toggle="toggle"
        :open="isOpen"
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import { useToggle } from '@vueuse/core'

const props = withDefaults(defineProps<{
  maxHeight?: string
  initiallyOpen?: boolean
  lazy?: boolean
}>(), {
  initiallyOpen: false,
  maxHeight: '500px',
  lazy: false,
})

const [isOpen, toggle] = useToggle(props.initiallyOpen)

</script>
